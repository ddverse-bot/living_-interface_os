<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Living Interface OS</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

  <!-- GSAP + Lenis -->
  <script src="https://unpkg.com/gsap@3/dist/gsap.min.js"></script>
  <script src="https://unpkg.com/gsap@3/dist/ScrollTrigger.min.js"></script>
  <script src="https://unpkg.com/@studio-freight/lenis"></script>

  <!-- Three.js -->
  <script src="https://unpkg.com/three@0.155.0/build/three.min.js"></script>

  <style>
    :root {
      --bg: #0a0a0a;
      --fg: #ffffff;
      --glass: rgba(255,255,255,0.08);
      --blur: 20px;
    }

    * {
      box-sizing: border-box;
      cursor: none;
    }

    html, body {
      margin: 0;
      padding: 0;
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--fg);
      overflow: hidden;
    }

    /* Boot Screen */
    #boot {
      position: fixed;
      inset: 0;
      background: black;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }

    #boot h1 {
      font-weight: 300;
      letter-spacing: 0.15em;
      opacity: 0.8;
    }

    /* Desktop */
    #desktop {
      width: 100vw;
      height: 100vh;
      position: relative;
      overflow: hidden;
    }

    /* Windows */
    .window {
      position: absolute;
      width: 300px;
      height: 200px;
      background: var(--glass);
      backdrop-filter: blur(var(--blur));
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 40px 80px rgba(0,0,0,0.4);
      transition: transform 0.2s ease;
    }

    /* Dock */
    #dock {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 20px;
    }

    .dock-item {
      width: 48px;
      height: 48px;
      background: var(--glass);
      border-radius: 12px;
      backdrop-filter: blur(10px);
      transition: transform 0.3s ease;
    }

    .dock-item:hover {
      transform: scale(1.3);
    }

    /* Cursor */
    #cursor {
      position: fixed;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: white;
      pointer-events: none;
      mix-blend-mode: difference;
      z-index: 1000;
    }

    /* Settings */
    #settings {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 260px;
      background: var(--glass);
      backdrop-filter: blur(20px);
      border-radius: 16px;
      padding: 16px;
    }

    input[type=range] {
      width: 100%;
    }
  </style>
</head>
<body>

  <div id="boot"><h1>Initializing Creativity…</h1></div>

  <div id="cursor"></div>

  <div id="desktop">
    <div class="window" style="top:120px;left:100px">Project Alpha</div>
    <div class="window" style="top:380px;left:260px">Project Beta</div>
    <div class="window" style="top:200px;left:520px">Project Gamma</div>

    <div id="dock">
      <div class="dock-item"></div>
      <div class="dock-item"></div>
      <div class="dock-item"></div>
    </div>

    <div id="settings">
      <h4>Physics</h4>
      <label>Gravity</label>
      <input type="range" min="0" max="1" step="0.01" value="0.3" id="gravity" />
    </div>
  </div>

  <script>
    /* Boot */
    gsap.to('#boot', { opacity: 0, duration: 1, delay: 2, onComplete: () => boot.remove() })

    /* Lenis Scroll */
    const lenis = new Lenis({ smooth: true })
    function raf(time) { lenis.raf(time); requestAnimationFrame(raf) }
    requestAnimationFrame(raf)

    /* Cursor Physics */
    const cursor = document.getElementById('cursor')
    let mouse = { x: 0, y: 0 }

    window.addEventListener('mousemove', e => {
      mouse.x = e.clientX
      mouse.y = e.clientY
      gsap.to(cursor, { x: mouse.x, y: mouse.y, duration: 0.2 })
    })

    /* Gravity Effect */
    const windows = document.querySelectorAll('.window')
    const gravityInput = document.getElementById('gravity')

    function applyGravity() {
      windows.forEach(w => {
        const rect = w.getBoundingClientRect()
        const dx = mouse.x - (rect.left + rect.width / 2)
        const dy = mouse.y - (rect.top + rect.height / 2)
        const dist = Math.sqrt(dx * dx + dy * dy) || 1
        const force = gravityInput.value * 80 / dist

        gsap.to(w, {
          x: dx * force,
          y: dy * force,
          duration: 0.4,
          ease: 'power3.out'
        })
      })
      requestAnimationFrame(applyGravity)
    }

    applyGravity()

    /* Hesitation Detection */
    let lastMove = Date.now()
    window.addEventListener('mousemove', () => lastMove = Date.now())

    setInterval(() => {
      const idle = Date.now() - lastMove
      gsap.to('body', {
        backgroundColor: idle > 1500 ? '#050505' : '#0a0a0a',
        duration: 1
      })
    }, 500)

    /* Idle Rearrangement */
    setInterval(() => {
      windows.forEach(w => {
        gsap.to(w, {
          x: gsap.utils.random(-100, 100),
          y: gsap.utils.random(-100, 100),
          duration: 2,
          ease: 'elastic.out(1,0.5)'
        })
      })
    }, 8000)

    /* Time-of-Day via Scroll */
    window.addEventListener('wheel', e => {
      const darkness = Math.min(Math.abs(e.deltaY) / 500, 1)
      document.documentElement.style.setProperty('--bg', `rgb(${10 - darkness*5},${10 - darkness*5},${10 - darkness*5})`)
    })
  /* ===================== NEXT-LEVEL UPGRADES ===================== */

    /* 1️⃣ Inertia-based draggable windows */
    windows.forEach(win => {
      let isDown = false, velocity = { x: 0, y: 0 }, last = { x: 0, y: 0 }

      win.addEventListener('mousedown', e => {
        isDown = true
        last.x = e.clientX
        last.y = e.clientY
      })

      window.addEventListener('mousemove', e => {
        if (!isDown) return
        velocity.x = e.clientX - last.x
        velocity.y = e.clientY - last.y
        gsap.set(win, { x: '+=' + velocity.x, y: '+=' + velocity.y })
        last.x = e.clientX
        last.y = e.clientY
      })

      window.addEventListener('mouseup', () => {
        if (!isDown) return
        isDown = false
        gsap.to(win, {
          x: '+=' + velocity.x * 10,
          y: '+=' + velocity.y * 10,
          duration: 1.2,
          ease: 'power3.out'
        })
      })
    })

    /* 2️⃣ WebGL Ambient Background (Three.js) */
    const scene = new THREE.Scene()
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000)
    const renderer = new THREE.WebGLRenderer({ alpha: true })
    renderer.setSize(window.innerWidth, window.innerHeight)
    renderer.domElement.style.position = 'fixed'
    renderer.domElement.style.top = 0
    renderer.domElement.style.zIndex = 0
    document.body.appendChild(renderer.domElement)

    const geometry = new THREE.PlaneGeometry(10, 10, 32, 32)
    const material = new THREE.MeshBasicMaterial({ color: 0x111111, wireframe: true })
    const plane = new THREE.Mesh(geometry, material)
    scene.add(plane)
    camera.position.z = 5

    function animate() {
      plane.rotation.x += 0.0005
      plane.rotation.y += 0.001
      renderer.render(scene, camera)
      requestAnimationFrame(animate)
    }
    animate()

    /* 3️⃣ CSS Houdini – paintWorklet (experimental) */
    if ('paintWorklet' in CSS) {
      CSS.paintWorklet.addModule('data:application/javascript,registerPaint("noise",class{paint(ctx,geom){for(let i=0;i<200;i++){ctx.fillStyle=`rgba(255,255,255,${Math.random()*0.03})`;ctx.fillRect(Math.random()*geom.width,Math.random()*geom.height,1,1)}}})')
      document.body.style.backgroundImage = 'paint(noise)'
    }

  </script>

</body>
</html>
